!function(e){function t(t,l){var c,r,i,s=this,a=t.add(s),f=e(window),u=e.tools.expose&&(l.mask||l.expose),d=Math.random().toString().slice(10);u&&("string"==typeof u&&(u={color:u}),u.closeOnClick=u.closeOnEsc=!1);var p=l.target||t.attr("rel");if(r=p?e(p):null||t,!r.length)throw"Could not find Overlay: "+p;t&&-1==t.index(r)&&t.click(function(e){return s.load(e),e.preventDefault()}),e.extend(s,{load:function(t){if(s.isOpened())return s;var c=n[l.effect];if(!c)throw'Overlay: cannot find effect : "'+l.effect+'"';if(l.oneInstance&&e.each(o,function(){this.close(t)}),t=t||e.Event(),t.type="onBeforeLoad",a.trigger(t),t.isDefaultPrevented())return s;i=!0,u&&e(r).expose(u);var p=l.top,g=l.left,h=r.outerWidth({margin:!0}),v=r.outerHeight({margin:!0});return"string"==typeof p&&(p="center"==p?Math.max((f.height()-v)/2,0):parseInt(p,10)/100*f.height()),"center"==g&&(g=Math.max((f.width()-h)/2,0)),c[0].call(s,{top:p,left:g},function(){i&&(t.type="onLoad",a.trigger(t))}),u&&l.closeOnClick&&e.mask.getMask().one("click",s.close),l.closeOnClick&&e(document).on("click."+d,function(t){e(t.target).parents(r).length||s.close(t)}),l.closeOnEsc&&e(document).on("keydown."+d,function(e){27==e.keyCode&&s.close(e)}),s},close:function(t){return s.isOpened()?(t=t||e.Event(),t.type="onBeforeClose",a.trigger(t),t.isDefaultPrevented()?void 0:(i=!1,n[l.effect][1].call(s,function(){t.type="onClose",a.trigger(t)}),e(document).off("click."+d+" keydown."+d),u&&e.mask.close(),s)):s},getOverlay:function(){return r},getTrigger:function(){return t},getClosers:function(){return c},isOpened:function(){return i},getConf:function(){return l}}),e.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),function(t,o){e.isFunction(l[o])&&e(s).on(o,l[o]),s[o]=function(t){return t&&e(s).on(o,t),s}}),c=r.find(l.close||".close"),c.length||l.close||(c=e('<a class="close"></a>'),r.prepend(c)),c.click(function(e){s.close(e)}),l.load&&s.load()}e.tools=e.tools||{version:"@VERSION"},e.tools.overlay={addEffect:function(e,t,o){n[e]=[t,o]},conf:{close:null,closeOnClick:!0,closeOnEsc:!0,closeSpeed:"fast",effect:"default",fixed:!e.support.msie||e.support.version>6,left:"center",load:!1,mask:null,oneInstance:!0,speed:"normal",target:null,top:"10%"}};var o=[],n={};e.tools.overlay.addEffect("default",function(t,o){var n=this.getConf(),l=e(window);n.fixed||(t.top+=l.scrollTop(),t.left+=l.scrollLeft()),t.position=n.fixed?"fixed":"absolute",this.getOverlay().css(t).fadeIn(n.speed,o)},function(e){this.getOverlay().fadeOut(this.getConf().closeSpeed,e)}),e.fn.overlay=function(n){var l=this.data("overlay");return l?l:(e.isFunction(n)&&(n={onBeforeLoad:n}),n=e.extend(!0,{},e.tools.overlay.conf,n),this.each(function(){l=new t(e(this),n),o.push(l),e(this).data("overlay",l)}),n.api?l:this)}}(jQuery);